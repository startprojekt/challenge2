{% extends "base.html" %}
{% load benford_tags %}

{% block content %}
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-auto">
        <a href="{% url 'benford:dashboard' %}" class="text-secondary">
          <svg width="1.8em" height="1.8em" viewBox="0 0 16 16" class="bi bi-arrow-left-square-fill" fill="currentColor"
               xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
                  d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.354 10.646a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L6.207 7.5H11a.5.5 0 0 1 0 1H6.207l2.147 2.146z"/>
          </svg>
        </a>
      </div>
      <div class="col"><h1>{{ analyzer.dataset.display_title }}</h1></div>
    </div>

    <div class="row mt-3">
      <div class="col-12 col-md-6">
        <div>
          {% with is_compliant=analyzer.is_compliant_with_benford_law %}
            Is this dataset compliant with Benford's Law?
            <div class="display-6">
              <div class="badge {% if is_compliant %}bg-success{% else %}bg-danger{% endif %}">
                {{ is_compliant|yesno|upper }}</div>
            </div>
          {% endwith %}
        </div>

        <table id="table-dataset-summary" class="table my-3">
          <thead>
          <tr>
            <th>Digit</th>
            <th>Occurences</th>
            <th>Percent</th>
            <th>Expected</th>
          </tr>
          </thead>
          <tbody>
          {% for significant_digit in analyzer.get_summary %}
            <tr>
              <td>{{ significant_digit.digit }}</td>
              <td>{{ significant_digit.occurences }}</td>
              <td>{{ significant_digit.percentage }}</td>
              <td>{{ significant_digit.expected_percentage }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>

        {#        <div>#}
        {#          The chi-squared test statistic = {{ analyzer.get_chisq_test_statistic }}#}
        {#        </div>#}
      </div>

      <div class="col-12 col-md-6 col-graph">
        {% graph analyzer %}
      </div>
    </div>

  </div>

  {% if dataset_rows.exists %}
    <div class="container-fluid">
      <h2>Erroneous rows</h2>

      <p>There were some rows in the dataset that couldn't be processed
        correctly. They are not included in the above analysis.</p>

      <div class="row">
        <div class="col">
          <table class="table">
            {% for row in dataset_rows %}
              <tr{% if row.has_error %} class="text-danger"{% endif %}>
                <td>{{ row.line }}</td>
                {% for col in row.data %}
                  <td>{{ col }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}